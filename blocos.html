<html>
    <head>
        <script src="blockly/blockly_compressed.js"></script>
        <script src="blockly/blocks_compressed.js"></script>
        <script src="blockly/javascript_compressed.js"></script>
        <script src="blockly/msg/js/pt-br.js"></script>
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
        <style>
            #text_aux{
                pointer-events: none;
            }
        </style>
    </head>

    <body>
        
        <div id="workspaceArea" style="height: 400px; width: 100%;"></div>

        <!-- Este XML é a paleta de blocos do lado esquerdo -->
        <td>
          <xml id="toolbox" style="display: none">
            <category name="Logicos" colour="%{BKY_LOGIC_HUE}">
              <block type="controls_if"></block>
              <block type="logic_compare"></block>
              <block type="logic_operation"></block>
              <block type="logic_negate"></block>
              <block type="logic_boolean"></block>
              <block type="logic_null"></block>
              <block type="logic_ternary"></block>
            </category>
            <category name="Loops" colour="%{BKY_LOOPS_HUE}">
              <block type="controls_repeat_ext"></block>
              <block type="controls_whileUntil"></block>
              <block type="controls_for">
                <value name="BY">
                  <shadow type="math_number">
                    <field name="NUM">1</field>
                  </shadow>
                </value>
              </block>
              <block type="controls_forEach"></block>
              <block type="controls_flow_statements"></block>
            </category>
            <category name="Matemáticos" colour="%{BKY_MATH_HUE}">
              <block type="math_number"></block>
              <block type="math_arithmetic">

              </block>
              <block type="math_single">

              </block>
              <block type="math_trig">

              </block>
              <block type="math_constant"></block>
              <block type="math_number_property">

              </block>
              <block type="math_round">

              </block>
              <block type="math_on_list"></block>
              <block type="math_modulo">

              </block>
              <block type="math_constrain">


              </block>
              <block type="math_random_int">

              </block>
              <block type="math_random_float"></block>
            </category>
            <category name="Texto" colour="%{BKY_TEXTS_HUE}">
              <block type="text"></block>
              <block type="text_join"></block>
              <block type="text_append">
                <value name="TEXT">
                  <shadow type="text"></shadow>
                </value>
              </block>
              <block type="text_print"></block>
              <block type="text_length">
                <value name="VALUE">
                  <shadow type="text">
                    <field name="TEXT">abc</field>
                  </shadow>
                </value>
              </block>
              <block type="text_isEmpty">
                <value name="VALUE">
                  <shadow type="text">
                    <field name="TEXT"></field>
                  </shadow>
                </value>
              </block>
              <block type="text_indexOf">
                <value name="VALUE">
                  <block type="variables_get">
                    <field name="VAR">{textVariable}</field>
                  </block>
                </value>
                <value name="FIND">
                  <shadow type="text">
                    <field name="TEXT">abc</field>
                  </shadow>
                </value>
              </block>
              <block type="text_charAt">
                <value name="VALUE">
                  <block type="variables_get">
                    <field name="VAR">{textVariable}</field>
                  </block>
                </value>
              </block>
              <block type="text_getSubstring">
                <value name="STRING">
                  <block type="variables_get">
                    <field name="VAR">{textVariable}</field>
                  </block>
                </value>
              </block>
              <block type="text_changeCase">
                <value name="TEXT">
                  <shadow type="text">
                    <field name="TEXT">abc</field>
                  </shadow>
                </value>
              </block>
              <block type="text_trim">
                <value name="TEXT">
                  <shadow type="text">
                    <field name="TEXT">abc</field>
                  </shadow>
                </value>
              </block>
              <block type="text_print">
                <value name="TEXT">
                  <shadow type="text">
                    <field name="TEXT">abc</field>
                  </shadow>
                </value>
              </block>
              <block type="text_prompt_ext">
                <value name="TEXT">
                  <shadow type="text">
                    <field name="TEXT">abc</field>
                  </shadow>
                </value>
              </block>
            </category>
            <category name="Listas" colour="%{BKY_LISTS_HUE}">
              <block type="lists_create_with">
                <mutation items="0"></mutation>
              </block>
              <block type="lists_create_with"></block>
              <block type="lists_repeat">
                <value name="NUM">
                  <shadow type="math_number">
                    <field name="NUM">5</field>
                  </shadow>
                </value>
              </block>
              <block type="lists_length"></block>
              <block type="lists_isEmpty"></block>
              <block type="lists_indexOf">
                <value name="VALUE">
                  <block type="variables_get">
                    <field name="VAR">{listVariable}</field>
                  </block>
                </value>
              </block>
              <block type="lists_getIndex">
                <value name="VALUE">
                  <block type="variables_get">
                    <field name="VAR">{listVariable}</field>
                  </block>
                </value>
              </block>
              <block type="lists_setIndex">
                <value name="LIST">
                  <block type="variables_get">
                    <field name="VAR">{listVariable}</field>
                  </block>
                </value>
              </block>
              <block type="lists_getSublist">
                <value name="LIST">
                  <block type="variables_get">
                    <field name="VAR">{listVariable}</field>
                  </block>
                </value>
              </block>
              <block type="lists_split">
                <value name="DELIM">
                  <shadow type="text">
                    <field name="TEXT">,</field>
                  </shadow>
                </value>
              </block>
              <block type="lists_sort"></block>
            </category>
            <category name="Cores" colour="%{BKY_COLOUR_HUE}">
              <block type="colour_picker"></block>
              <block type="colour_random"></block>
              <block type="colour_rgb">
                <value name="RED">
                  <shadow type="math_number">
                    <field name="NUM">100</field>
                  </shadow>
                </value>
                <value name="GREEN">
                  <shadow type="math_number">
                    <field name="NUM">50</field>
                  </shadow>
                </value>
                <value name="BLUE">
                  <shadow type="math_number">
                    <field name="NUM">0</field>
                  </shadow>
                </value>
              </block>
              <block type="colour_blend">
                <value name="COLOUR1">
                  <shadow type="colour_picker">
                    <field name="COLOUR">#ff0000</field>
                  </shadow>
                </value>
                <value name="COLOUR2">
                  <shadow type="colour_picker">
                    <field name="COLOUR">#3333ff</field>
                  </shadow>
                </value>
                <value name="RATIO">
                  <shadow type="math_number">
                    <field name="NUM">0.5</field>
                  </shadow>
                </value>
              </block>
            </category>
            <sep></sep>
            <category name="Variáveis" colour="%{BKY_VARIABLES_HUE}" custom="VARIABLE"></category>
            <category name="Funções" colour="%{BKY_PROCEDURES_HUE}" custom="PROCEDURE"></category>
          </xml>
        </td>

        <td>
            <p style="text-align: center;">
                <button onclick="showCode();">Show JavaScript</button>
                <button onclick="runCode();">Run JavaScript</button>
            </p>
        </td>

        <div id="text_aux" style="height: 400px; width: 100%;"></div>

        <script>
        
            // Generate JavaScript code and display it.
            function showCode() {
              Blockly.JavaScript.INFINITE_LOOP_TRAP = null;
              var code = Blockly.JavaScript.workspaceToCode(workspaceArea);
              alert(code);

            }

            // Generate JavaScript code and run it.
            function runCode() {
              var code = Blockly.JavaScript.workspaceToCode(workspaceArea);
              try {
                eval(code);
              } catch (e) {
                alert(e);
              }
            }
            
            var workspaceArea = Blockly.inject('workspaceArea', {
                    media: 'blockly/media/',
                    toolbox: document.getElementById('toolbox')
            });
            var workspace = Blockly.inject('text_aux', {
                    media: 'blockly/media/',
                    toolbox: document.getElementById('toolbox')
            });
            
            function changeBlockly() {
                
                var blocos = Blockly.Xml.workspaceToDom(workspaceArea);
                document.getElementById('text_aux').value = blocos;
                workspace.clear();
                Blockly.Xml.domToWorkspace(document.getElementById('text_aux').value, workspace);
                
            }
            workspaceArea.addChangeListener(changeBlockly);
        </script>
    </body>
</html>